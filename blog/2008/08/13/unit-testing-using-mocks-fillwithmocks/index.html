<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Unit Testing using Mocks - FillWithMocks, Fill all or only selected properties with Mocks using only a single method call | Sohan's Blog</title>
<meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="I have been doing TDD for about two years now and using mock testing for interaction based unit testing in my projects. What I have learned over this time is, a unit testable design leads to introduction of interfaces and dependency injection for testing a code in isolation. And when I want to perform tests on my interactions, I need to create mock objects and inject these mock instances to my object under test."><meta name=generator content="Hugo 0.121.2"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Unit Testing using Mocks - FillWithMocks, Fill all or only selected properties with Mocks using only a single method call"><meta property="og:description" content="I have been doing TDD for about two years now and using mock testing for interaction based unit testing in my projects. What I have learned over this time is, a unit testable design leads to introduction of interfaces and dependency injection for testing a code in isolation. And when I want to perform tests on my interactions, I need to create mock objects and inject these mock instances to my object under test."><meta property="og:type" content="article"><meta property="og:url" content="http://smsohan.com/blog/2008/08/13/unit-testing-using-mocks-fillwithmocks/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2008-08-13T00:00:00+00:00"><meta property="article:modified_time" content="2008-08-13T00:00:00+00:00"><meta itemprop=name content="Unit Testing using Mocks - FillWithMocks, Fill all or only selected properties with Mocks using only a single method call"><meta itemprop=description content="I have been doing TDD for about two years now and using mock testing for interaction based unit testing in my projects. What I have learned over this time is, a unit testable design leads to introduction of interfaces and dependency injection for testing a code in isolation. And when I want to perform tests on my interactions, I need to create mock objects and inject these mock instances to my object under test."><meta itemprop=datePublished content="2008-08-13T00:00:00+00:00"><meta itemprop=dateModified content="2008-08-13T00:00:00+00:00"><meta itemprop=wordCount content="640"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Unit Testing using Mocks - FillWithMocks, Fill all or only selected properties with Mocks using only a single method call"><meta name=twitter:description content="I have been doing TDD for about two years now and using mock testing for interaction based unit testing in my projects. What I have learned over this time is, a unit testable design leads to introduction of interfaces and dependency injection for testing a code in isolation. And when I want to perform tests on my interactions, I need to create mock objects and inject these mock instances to my object under test."><style>.athelas,.body-text{font-family:helvetica neue,Helvetica,Arial,sans-serif}.body-text div,p,article,section{font-size:1rem;line-height:1.4rem}.athelas.fw1{font-weight:inherit}h1.f1{line-height:4rem}</style></head><body class="ma0 body-text"><header><div class=bg-navy><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Sohan's Blog</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/home/ title="About page">About</a></li></ul><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Unit Testing using Mocks - FillWithMocks, Fill all or only selected properties with Mocks using only a single method call</h1><time class="f6 mv4 dib tracked" datetime=2008-08-13T00:00:00Z>August 13, 2008</time></header><div class="nested-copy-line-height lh-copy body-text f4 nested-links mid-gray pr4-l w-two-thirds-l"><div class=post><p>I have been doing TDD for about two years now and using mock testing for interaction based unit testing in my projects. What I have learned over this time is, a unit testable design leads to introduction of interfaces and dependency injection for testing a code in isolation. And when I want to perform tests on my interactions, I need to create mock objects and inject these mock instances to my object under test. Sometimes, a unit test class needs to create quite a few of such mock objects and I feel this can be done using a simple wrapper around the usual mocking frameworks.</p><p>I suggest a similar and even more powerful wrapper so that you don't need to create instances for each of the mock objects, rather do it in a single call for all your desired mocks. I have shown this method for NMock2, however, its evident that you can write your own method for your favorite mocking framework just using this code as a reference.</p><p>This code is written in C# 3.0 and should compile in .Net 3.5. You will need to add a reference to NMock2 to compile this. Also, you need to know a bit about Reflection to understand the following code fragment.</p><p><strong>Disclaimer:</strong> This code is just a simple example and it may not suit all your needs.</p><div style="background:#fff repeat;-moz-background-clip:-moz-initial;-moz-background-origin:-moz-initial;-moz-background-inline-policy:-moz-initial;font-family:courier new;font-size:10pt;color:#000"><p style=margin:0><span style=color:#2b91af>1</span> <span style=color:blue>using</span> System;</p><p style=margin:0><span style=color:#2b91af>2</span> <span style=color:blue>using</span> System.Collections.Generic;</p><p style=margin:0><span style=color:#2b91af>3</span> <span style=color:blue>using</span> System.Linq;</p><p style=margin:0><span style=color:#2b91af>4</span> <span style=color:blue>using</span> System.Text;</p><p style=margin:0><span style=color:#2b91af>5</span> <span style=color:blue>using</span> System.Reflection;</p><p style=margin:0><span style=color:#2b91af>6</span></p><p style=margin:0><span style=color:#2b91af>7</span></p><p style=margin:0><span style=color:#2b91af>8</span> <span style=color:blue>namespace</span> NMock2.Extensions</p><p style=margin:0><span style=color:#2b91af>9</span> {</p><p style=margin:0><span style=color:#2b91af>10</span> <span style=color:blue>public</span> <span style=color:blue>static</span> <span style=color:blue>class</span> <span style=color:#2b91af>MockeryExtensions</span></p><p style=margin:0><span style=color:#2b91af>11</span> {</p><p style=margin:0><span style=color:#2b91af>12</span> <span style=color:gray>///</span><span style=color:green> </span><span style=color:gray>&lt;summary></span></p><p style=margin:0><span style=color:#2b91af>13</span> <span style=color:gray>///</span><span style=color:green> This method will fill all properties of the 'target' of interface type having a setter</span></p><p style=margin:0><span style=color:#2b91af>14</span> <span style=color:gray>///</span><span style=color:green> </span><span style=color:gray>&lt;/summary></span></p><p style=margin:0><span style=color:#2b91af>15</span> <span style=color:gray>///</span><span style=color:green> </span><span style=color:gray>&lt;param name="mocks">&lt;/param></span></p><p style=margin:0><span style=color:#2b91af>16</span> <span style=color:gray>///</span><span style=color:green> </span><span style=color:gray>&lt;param name="target">&lt;/param></span></p><p style=margin:0><span style=color:#2b91af>17</span> <span style=color:blue>public</span> <span style=color:blue>static</span> <span style=color:blue>void</span> FillWithMocks(<span style=color:blue>this</span> <span style=color:#2b91af>Mockery</span> mocks, <span style=color:blue>object</span> target)</p><p style=margin:0><span style=color:#2b91af>18</span> {</p><p style=margin:0><span style=color:#2b91af>19</span> <span style=color:#2b91af>Type</span> targetType = target.GetType();</p><p style=margin:0><span style=color:#2b91af>20</span> <span style=color:#2b91af>PropertyInfo</span> []properties = target.GetType().GetProperties();</p><p style=margin:0><span style=color:#2b91af>21</span></p><p style=margin:0><span style=color:#2b91af>22</span> <span style=color:blue>foreach</span> (<span style=color:#2b91af>PropertyInfo</span> property <span style=color:blue>in</span> properties)</p><p style=margin:0><span style=color:#2b91af>23</span> {</p><p style=margin:0><span style=color:#2b91af>24</span> <span style=color:#2b91af>Type</span> ptype = property.PropertyType;</p><p style=margin:0><span style=color:#2b91af>25</span> <span style=color:blue>if</span> (ptype.IsInterface)</p><p style=margin:0><span style=color:#2b91af>26</span> {</p><p style=margin:0><span style=color:#2b91af>27</span> <span style=color:blue>if</span>(targetType.GetMethod(<span style=color:blue>string</span>.Format(<span style=color:#a31515>"set_{0}"</span>, property.Name)) != <span style=color:blue>null</span>)</p><p style=margin:0><span style=color:#2b91af>28</span> {</p><p style=margin:0><span style=color:#2b91af>29</span> targetType.GetProperty(property.Name).SetValue(target, mocks.NewMock(ptype), <span style=color:blue>new</span> <span style=color:blue>object</span>[] { });</p><p style=margin:0><span style=color:#2b91af>30</span> }</p><p style=margin:0><span style=color:#2b91af>31</span> }</p><p style=margin:0><span style=color:#2b91af>32</span> }</p><p style=margin:0><span style=color:#2b91af>33</span> }</p><p style=margin:0><span style=color:#2b91af>34</span></p><p style=margin:0><span style=color:#2b91af>35</span> <span style=color:gray>///</span><span style=color:green> </span><span style=color:gray>&lt;summary></span></p><p style=margin:0><span style=color:#2b91af>36</span> <span style=color:gray>///</span><span style=color:green> This method will fill the properties with names specified in the propertyNames array having a setter</span></p><p style=margin:0><span style=color:#2b91af>37</span> <span style=color:gray>///</span><span style=color:green> </span><span style=color:gray>&lt;/summary></span></p><p style=margin:0><span style=color:#2b91af>38</span> <span style=color:gray>///</span><span style=color:green> </span><span style=color:gray>&lt;param name="mocks">&lt;/param></span></p><p style=margin:0><span style=color:#2b91af>39</span> <span style=color:gray>///</span><span style=color:green> </span><span style=color:gray>&lt;param name="target">&lt;/param></span></p><p style=margin:0><span style=color:#2b91af>40</span> <span style=color:gray>///</span><span style=color:green> </span><span style=color:gray>&lt;param name="propertyNames">&lt;/param></span></p><p style=margin:0><span style=color:#2b91af>41</span> <span style=color:blue>public</span> <span style=color:blue>static</span> <span style=color:blue>void</span> FillWithMocks(<span style=color:blue>this</span> <span style=color:#2b91af>Mockery</span> mocks, <span style=color:blue>object</span> target, <span style=color:blue>params</span> <span style=color:blue>string</span>[] propertyNames)</p><p style=margin:0><span style=color:#2b91af>42</span> {</p><p style=margin:0><span style=color:#2b91af>43</span> <span style=color:#2b91af>Type</span> targetType = target.GetType();</p><p style=margin:0><span style=color:#2b91af>44</span> <span style=color:blue>foreach</span> (<span style=color:blue>string</span> propertyName <span style=color:blue>in</span> propertyNames)</p><p style=margin:0><span style=color:#2b91af>45</span> {</p><p style=margin:0><span style=color:#2b91af>46</span> <span style=color:#2b91af>PropertyInfo</span> pInfo = targetType.GetProperty(propertyName);</p><p style=margin:0><span style=color:#2b91af>47</span> <span style=color:blue>if</span> (pInfo != <span style=color:blue>null</span> && targetType.GetMethod(<span style=color:blue>string</span>.Format(<span style=color:#a31515>"set_{0}"</span>, propertyName)) != <span style=color:blue>null</span>)</p><p style=margin:0><span style=color:#2b91af>48</span> {</p><p style=margin:0><span style=color:#2b91af>49</span> pInfo.SetValue(target, mocks.NewMock(pInfo.PropertyType), <span style=color:blue>null</span>);</p><p style=margin:0><span style=color:#2b91af>50</span> }</p><p style=margin:0><span style=color:#2b91af>51</span> <span style=color:blue>else</span></p><p style=margin:0><span style=color:#2b91af>52</span> {</p><p style=margin:0><span style=color:#2b91af>53</span> <span style=color:blue>throw</span> <span style=color:blue>new</span> <span style=color:#2b91af>ArgumentException</span>(<span style=color:blue>string</span>.Format(<span style=color:#a31515>"the property {0} is not found or does not have a setter"</span>, pInfo.Name));</p><p style=margin:0><span style=color:#2b91af>54</span> }</p><p style=margin:0><span style=color:#2b91af>55</span> }</p><p style=margin:0><span style=color:#2b91af>56</span> }</p><p style=margin:0><span style=color:#2b91af>57</span> }</p><p style=margin:0><span style=color:#2b91af>58</span> }</p></div><p>So, with this extension method in place, you can go and write your test code in a much compact manner. The following is an example showing one possible use of this method in your NUnit test code.</p><div style="background:#fff repeat;-moz-background-clip:-moz-initial;-moz-background-origin:-moz-initial;-moz-background-inline-policy:-moz-initial;font-family:courier new;font-size:10pt;color:#000"><p style=margin:0><span style=color:#2b91af>83</span> <span style=color:blue>public</span> <span style=color:blue>interface</span> <span style=color:#2b91af>IMyInterface</span></p><p style=margin:0><span style=color:#2b91af>84</span> {</p><p style=margin:0><span style=color:#2b91af>85</span> <span style=color:blue>void</span> MyMethod(<span style=color:blue>string</span> name);</p><p style=margin:0><span style=color:#2b91af>86</span> }</p><p style=margin:0><span style=color:#2b91af>87</span></p><p style=margin:0><span style=color:#2b91af>88</span> <span style=color:blue>public</span> <span style=color:blue>class</span> <span style=color:#2b91af>MyExampleClass</span></p><p style=margin:0><span style=color:#2b91af>89</span> {</p><p style=margin:0><span style=color:#2b91af>90</span> <span style=color:blue>public</span> <span style=color:#2b91af>IMyInterface</span> MyPropertyOne</p><p style=margin:0><span style=color:#2b91af>91</span> {</p><p style=margin:0><span style=color:#2b91af>92</span> <span style=color:blue>get</span>;</p><p style=margin:0><span style=color:#2b91af>93</span> <span style=color:blue>set</span>;</p><p style=margin:0><span style=color:#2b91af>94</span> }</p><p style=margin:0><span style=color:#2b91af>95</span></p><p style=margin:0><span style=color:#2b91af>96</span> <span style=color:blue>public</span> <span style=color:#2b91af>IMyInterface</span> MyPropertyTwo</p><p style=margin:0><span style=color:#2b91af>97</span> {</p><p style=margin:0><span style=color:#2b91af>98</span> <span style=color:blue>get</span>;</p><p style=margin:0><span style=color:#2b91af>99</span> <span style=color:blue>set</span>;</p><p style=margin:0><span style=color:#2b91af>100</span> }</p><p style=margin:0><span style=color:#2b91af>101</span></p><p style=margin:0><span style=color:#2b91af>102</span> <span style=color:blue>public</span> <span style=color:#2b91af>IMyInterface</span> MyPropertyThree</p><p style=margin:0><span style=color:#2b91af>103</span> {</p><p style=margin:0><span style=color:#2b91af>104</span> <span style=color:blue>get</span>;</p><p style=margin:0><span style=color:#2b91af>105</span> <span style=color:blue>set</span>;</p><p style=margin:0><span style=color:#2b91af>106</span> }</p><p style=margin:0><span style=color:#2b91af>107</span></p><p style=margin:0><span style=color:#2b91af>108</span> <span style=color:blue>public</span> MyExampleClass()</p><p style=margin:0><span style=color:#2b91af>109</span> {</p><p style=margin:0><span style=color:#2b91af>110</span></p><p style=margin:0><span style=color:#2b91af>111</span> }</p><p style=margin:0><span style=color:#2b91af>112</span> }</p><p style=margin:0><span style=color:#2b91af>113</span></p><p style=margin:0><span style=color:#2b91af>114</span> [<span style=color:#2b91af>TestFixture</span>]</p><p style=margin:0><span style=color:#2b91af>115</span> <span style=color:blue>public</span> <span style=color:blue>class</span> <span style=color:#2b91af>MyExampleClassTest</span></p><p style=margin:0><span style=color:#2b91af>116</span> {</p><p style=margin:0><span style=color:#2b91af>117</span> <span style=color:blue>private</span> <span style=color:#2b91af>MyExampleClass</span> _myExampleClass;</p><p style=margin:0><span style=color:#2b91af>118</span> <span style=color:blue>private</span> <span style=color:#2b91af>Mockery</span> _mocks;</p><p style=margin:0><span style=color:#2b91af>119</span></p><p style=margin:0><span style=color:#2b91af>120</span> [<span style=color:#2b91af>SetUp</span>]</p><p style=margin:0><span style=color:#2b91af>121</span> <span style=color:blue>public</span> <span style=color:blue>void</span> Init()</p><p style=margin:0><span style=color:#2b91af>122</span> {</p><p style=margin:0><span style=color:#2b91af>123</span> _myExampleClass = <span style=color:blue>new</span> <span style=color:#2b91af>MyExampleClass</span>();</p><p style=margin:0><span style=color:#2b91af>124</span> _mocks = <span style=color:blue>new</span> <span style=color:#2b91af>Mockery</span>();</p><p style=margin:0><span style=color:#2b91af>125</span></p><p style=margin:0><span style=color:#2b91af>126</span> <span style=color:green>//This call fills all the three properties with mocks</span></p><p style=margin:0><span style=color:#2b91af>127</span> _mocks.FillWithMocks(_myExampleClass);</p><p style=margin:0><span style=color:#2b91af>128</span></p><p style=margin:0><span style=color:#2b91af>129</span> <span style=color:green>//This call fills only MyPropertyOne and MyPropertyTwo with mocks</span></p><p style=margin:0><span style=color:#2b91af>130</span> _mocks.FillWithMocks(_myExampleClass, <span style=color:#a31515>"MyPropertyOne"</span>, <span style=color:#a31515>"MyPropertyTwo"</span>);</p><p style=margin:0><span style=color:#2b91af>131</span> }</p><p style=margin:0><span style=color:#2b91af>132</span> }</p></div><p>Comments are welcome!</p></div><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-navy bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=http://smsohan.com/>&copy; Sohan's Blog 2024</a><div><div class=ananke-socials></div></div></div></footer></body></html>